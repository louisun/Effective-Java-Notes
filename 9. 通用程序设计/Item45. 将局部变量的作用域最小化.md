# Item45. 将局部变量的作用域最小化



> 本章主要讨论 Java 语言的具体细节，讨论局部变量的处理、控制结构、类库的方法、各种数据类型的用法、反射和本地方法的用法，以及优化和命名惯例。



将局部变量的作用域最小化，和「使类和成员的可访问性最小化」本质是类似的。可以增强代码可读性、可维护性，降低出错概率。



**要使局部变量的作用域最小化，最有力的方法是「在第一次使用它的地方声明」**。在使用之前声明，会分散阅读者注意力。



几乎每个局部变量的声明都应该「包含一个初始化表达式」，如果没有足够的信息初始化，应该推迟这个声明直到可以初始化为止。一个例外就是 `try-catch`，如果一个变量被一个方法初始化，这个方法可能会抛出一个受检（checkd exception）异常，该变量就必须在 `try` 块内部被初始化，**如果变量必须在 `try` 块外部被用到，它就必须在 `try` 块之前被声明。**但是在 `try` 块之前，还不能被有意义地初始化。



循环中允许声明「**循环变量**」，在 `for` 循环、`for-each`中，作用域被限定为需要的范围内（包括循环体、循环体之前的初始化、测试、更新部分）。

> 如果在循环终止之后不需要循环变量的内容，`for` 循环优先于 `while` 循环。



下面是一种遍历集合的首选方法：



```java
for(Element e : c){
    ... // Do Something with e
}
```



如果你需要访问迭代器 `iterator`，也许为了调用 `remove` 方法，建议的方式是用传统 `for` 循环代替 `for-each` 循环：

![](https://bucket-1255905387.cos.ap-shanghai.myqcloud.com/2019-01-24-10-21-57_r14.png)



为什么这些 `for` 循环优先于 `while` 循环呢？举个例子：



![](https://bucket-1255905387.cos.ap-shanghai.myqcloud.com/2019-01-24-10-23-42_r21.png)



第二个 `while` 循环错误地使用了之前的 `i` 变量（`i.hasNext()`），而不是 `i2` 变量，而 `i` 变量由于定义在循环体外， 依然生效，编译器不会报错，但结果是错误的。如果用 `for` 循环编译器会报错，因为根本找不到这个 `i` 变量。



![](https://bucket-1255905387.cos.ap-shanghai.myqcloud.com/2019-01-24-10-32-43_r82.png)



而且，使用 for 循环，犯这种「复制-粘贴」错误可能性会大大降低，因为通常没有必要为两个循环使用不同的变量名，循环是独立的，所以重用变量名没有任何危害。实际上这是流行的做法。



`for` 循环的另一个优势就是更简短、更有可读性。下面是另一种对局部变量的作用于进行最小化的循环做法：



![](https://bucket-1255905387.cos.ap-shanghai.myqcloud.com/2019-01-24-10-35-43_r31.png)



要注意这里有 2 个循环变量：`i` 和 `n`，第二个变量用于存放第一个变量的「极限值」，从而避免每次迭代执行冗余的计算开销。通常如果循环测试中设计方法调用且返回结果是相同的，就应该使用这种方法。

最后一种「将局部变量的作用域最小化」的方法是「使方法小而集中」。这样不同方法的局部变量是隔离的，不会在另一个代码段中出现。





