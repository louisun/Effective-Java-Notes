



# Item15. 使可变现性最小化


实例不能被修改的类，每个实例包含的信息在创建时就提供，在对象整个生命周期之内固定不变。

Java 中的不可变类如 `String`、`BgiDecimal`、`BigInteger`

## 类不可变的准则

1. 不要提供任何会修改对象状态的方法
2. 保证类不会被扩展（防止子类化，一般使类为 final）
3. 使所有域都是 final 的
4. 使所有域都是私有的
5. 确保对于任何可变组件的互斥访问（该类的客户端）



![](https://bucket-1255905387.cos.ap-shanghai.myqcloud.com/2018-11-22-17-28-50_r9.png)





----



## 优缺点

![](https://bucket-1255905387.cos.ap-shanghai.myqcloud.com/2018-11-22-17-30-21_r10.png)



数学运算返回新的 `Complex` 实例，而不是修改这个实例，这叫做 **函数**的做法。



**不可变对象比较简单**，可变对象有任意复杂的空间，如果没有对 `mutator` 方法所执行的状态转换提供精确的描述，要可靠地使用可变类是很难的。



**不可变对象本质是线程安全的，可以被自由地共享**。



不可变的类可以提供一些静态工厂，把频繁被请求的实例缓存起来。



不可变对象可以被自由共享的结果是，用于不需要进行保护性拷贝，事实上无需做任何拷贝，因为这些拷贝等于原始对象，也不应该为不可变类提供 `clone` 方法或拷贝构造器，



不仅可以共享不可变对象，还可以共享它们的内部信息。



不可变对象为其他对象提供了大量的构件。



不可变对象真正唯一的缺点是：对于每个不同的值都需要一个单独的对象，创建这种对象的代价可能很高。



## 不用 final 如何不让子类继承



![](https://bucket-1255905387.cos.ap-shanghai.myqcloud.com/2018-11-22-17-56-34_r79.png)





---



如何类不能被做成是不可变的，仍然应该尽可能限制它的可变性质。降低对象可以存在的状态数，可以更容易地分析该对象的行为，同时降低出错的可能性。因此除非有令人信服的理由要使域变成非 final 的，否则每个域都要是 final 的。



